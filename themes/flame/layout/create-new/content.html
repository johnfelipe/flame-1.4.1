<style>.fl_sec_nav, footer {display: none;}</style>
<form action="#" method="post" class="create-{{PAGE_TYPE}}-form posts-managing">
	<div class="fl_new_header">
		<div class="fl_new_header_child">
			{{LANG create_new}} <span id="create_menu_toggle">{{PAGE_TYPE}}<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z" /></svg></span>
			<button type="button" data-btn-text="{{LANG publish}}" data-btn-icon="cloud-upload" class="btn-publish btn btn-blue pull-right" onclick="FL_SubmitNewsForm('publish')"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><path fill="currentColor" d="M5,4V6H19V4H5M5,14H9V20H15V14H19L12,7L5,14Z" /></svg> {{LANG publish}}</button>
			<button type="button" data-btn-text="{{LANG save_as_draft_btn}}" data-btn-icon="floppy-o" class="btn-blue btn btn-main pull-right" onclick="FL_SubmitNewsForm('draft')">{{LANG save_as_draft_btn}}</button>
			<button type="button" class="btn btn-gray pull-right" onclick="FL_Cancel();">{{LANG cancel}}</button>
		</div>
	</div>
	<div class="fl_write_post_area">
		<div class="container">
			<div class="content fl_create_title">
				<div class="form-group text-center" id="title_con">
					<div class="error-con"></div>
					<input  name="title" type="text" class="form-control text-center" placeholder="{{LANG type_a_title}}" dir="auto" autofocus>
				</div>
				<div class="form-group text-center" id="short_title_con">
					<div class="error-con"></div>
					<input  name="short_title" type="text" class="form-control text-center" placeholder="{{LANG short_title}}, {{LANG max_36_c}}" dir="auto">
				</div>
			</div>
			<div class="content">
				<div id="post-entries">
					{{NEW_ENTRY}}
				</div>
				<div class="fl_add_entry_prnt">{{ADD_ENTRIES}}</div>
			</div>
		</div>
	</div>
	<div class="fl_write_post_side">
		<?php if (!empty($_GET['type']) && $_GET['type'] != 'quiz'): ?>
			<div class="main-container">
				<h3 data-toggle="collapse" data-target="#collapseentry" aria-expanded="true" aria-controls="collapseentry">Entries <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M8.12 9.29L12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41 0L6.7 10.7c-.39-.39-.39-1.02 0-1.41.39-.38 1.03-.39 1.42 0z"></path></svg></h3>
				<div class="collapse in" id="collapseentry">
					<div class="content">
						<div class="flame_input flame_input_single">
							<select name="entries_per_page" id="entries_per_page">
								<option value="0">{{LANG all}}</option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="4">4</option>
								<option value="6">6</option>
								<option value="8">8</option>
								<option value="10">10</option>
							</select>
							<label for="entries_per_page">{{LANG entries_per_page}}</label>
						</div>
					</div>
				</div>
			</div>
		<?php endif;?>
		<div class="main-container" id="image_con">
			<h3 data-toggle="collapse" data-target="#collapseimage" aria-expanded="false" aria-controls="collapseimage">{{LANG p_img}} <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M8.12 9.29L12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41 0L6.7 10.7c-.39-.39-.39-1.02 0-1.41.39-.38 1.03-.39 1.42 0z"></path></svg></h3>
			<div class="collapse in" id="collapseimage">
				<div class="content">
				    <div class="error-con"></div>
					<div class="preview-image" id="post-preview-image" onclick="document.getElementById('news-preview-image').click(); return false">
						<div class="content">
							<svg height="50" viewBox="0 0 511.999 511.999" width="50" xmlns="http://www.w3.org/2000/svg"><g><path d="m384.607 391.45-238.951-323.177c-1.127-1.524-2.79-2.565-4.653-2.914l-43.415-8.113c-9.004-1.684-18.121.251-25.672 5.445-7.545 5.19-12.624 13.014-14.299 22.03l-57.034 306.94c-3.458 18.614 8.836 36.58 27.408 40.051l306.068 57.198c2.119.396 4.244.591 6.354.591 6.854 0 13.544-2.065 19.318-6.037 7.545-5.189 12.624-13.013 14.299-22.03l11.921-64.155c.379-2.045-.107-4.156-1.344-5.829z" fill="#bfd5dd"/><path d="m511.999 56.788v312.33c0 18.91-15.38 34.29-34.29 34.29h-311.29c-18.91 0-34.29-15.38-34.29-34.29v-312.33c0-18.91 15.38-34.29 34.29-34.29h311.29c18.91 0 34.29 15.38 34.29 34.29z" fill="#e5f5f9"/><path d="m511.999 56.788v312.33c0 18.91-15.38 34.29-34.29 34.29h-29.98c18.94 0 34.29-15.35 34.29-34.29v-312.33c0-18.94-15.35-34.29-34.29-34.29h29.98c18.91 0 34.29 15.38 34.29 34.29z" fill="#bfd5dd"/><path d="m482.019 60.058v260.69c0 4.15-3.35 7.5-7.5 7.5h-304.92c-4.14 0-7.5-3.35-7.5-7.5v-260.69c0-4.14 3.36-7.5 7.5-7.5h304.92c4.15 0 7.5 3.36 7.5 7.5z" fill="#5cd5ff"/><path d="m482.019 60.058v260.69c0 4.15-3.35 7.5-7.5 7.5h-30c4.14 0 7.5-3.36 7.5-7.5v-260.69c0-4.14-3.36-7.5-7.5-7.5h30c4.15 0 7.5 3.36 7.5 7.5z" fill="#5ab5ff"/><path d="m386.079 129.058c0 21.74-17.69 39.42-39.42 39.42-4.37 0-8.57-.71-12.5-2.03-15.63-5.24-26.92-20.02-26.92-37.39 0-17.36 11.29-32.15 26.92-37.39 3.93-1.32 8.13-2.03 12.5-2.03 21.73 0 39.42 17.69 39.42 39.42z" fill="#ffeb31"/><path d="m386.079 129.058c0 21.74-17.69 39.42-39.42 39.42-4.37 0-8.57-.71-12.5-2.03 15.63-5.24 26.92-20.02 26.92-37.39 0-17.36-11.29-32.15-26.92-37.39 3.93-1.32 8.13-2.03 12.5-2.03 21.73 0 39.42 17.69 39.42 39.42z" fill="#ffce00"/><path d="m482.019 270.488v50.26c0 4.15-3.35 7.5-7.5 7.5h-304.92c-4.14 0-7.5-3.35-7.5-7.5v-85.28h48.93l63.44-63.44c2.93-2.93 7.68-2.93 10.6 0l67.71 67.71 43.94-43.94c1.41-1.41 3.32-2.2 5.31-2.2s3.89.79 5.3 2.2z" fill="#91ff31"/><path d="m482.019 270.488v50.26c0 4.15-3.35 7.5-7.5 7.5h-30c4.14 0 7.5-3.36 7.5-7.5v-80.26z" fill="#00ea80"/></g></svg> {{LANG choose_img}}
						</div>
					</div>
					<input type="file" name="preview_image" id="news-preview-image" class="hidden" onchange="FL_UploadPreviewImage();">
				</div>
			</div>
		</div>
		<div class="main-container">
			<h3 data-toggle="collapse" data-target="#collapsedetails" aria-expanded="false" aria-controls="collapsedetails">{{LANG details}} <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M8.12 9.29L12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41 0L6.7 10.7c-.39-.39-.39-1.02 0-1.41.39-.38 1.03-.39 1.42 0z"></path></svg></h3>
			<div class="collapse in" id="collapsedetails">
				<div class="content">
					<div class="flame_input" id="description_con">
						<div class="error-con"></div>
						<textarea onkeyup="textAreaAdjust(this, 70);" name="description" rows="3" placeholder="{{LANG type_a_desc}}" dir="auto"></textarea>
						<label for="description">{{LANG type_a_desc}}</label>
					</div>
					<div class="flame_input" id="tags_con">
						<div class="error-con"></div>
						<input type="text" id="mySingleFieldTags" name="tags" placeholder="{{LANG tags}}" value="">
						<label for="mySingleFieldTags">{{LANG tags}}</label>
					</div>
					<div class="flame_input" id="category_con">
						<div class="error-con"></div>
						<select name="category" id="category">
							<option value="" selected disabled>{{LANG category}}</option>
							{{Categories}}
						</select>
						<label for="category">{{LANG category}}</label>
					</div>
				</div>
			</div>
		</div>
	</div>
	<input type="hidden" class="hash_id" name="hash_id" value="{{NEW_SESSION_HASH}}">
	<input type="hidden" name="post_preview_image" id="post-preview-image-input">
</form>

<div id="img-uploading-wrapper" class="hidden">    
	<div class="loader"></div>
</div>

<script>
var form             = $('.create-{{PAGE_TYPE}}-form');
var data_entry       = new Array();
var data             = new Array();
var data_string      = new Array();
var form_name        = '';
var btn_save_text    = $('.btn-save').attr('data-btn-text');
var btn_save_icon    = $('.btn-save').attr('data-btn-icon');
var btn_publish_text = $('.btn-publish').attr('data-btn-text');
var btn_publish_icon = $('.btn-publish').attr('data-btn-icon');

$(function() {
	$("#mySingleFieldTags").tagit();
	$("[data-type=text] textarea").each(function (d) {
	    CKEDITOR.replace(this);
    });
});

$(document).on('click','#create_menu_toggle',function(e){
	e.stopPropagation();
	$('.dropdown-toggle.create').dropdown('toggle');
});

function FL_SubmitNewsForm(submit_type) {
	for(var instanceName in CKEDITOR.instances) {
		CKEDITOR.instances[instanceName].updateElement();
	}
	if (submit_type == '' || (typeof submit_type == 'undefined')) {
		return false;
	}
	entries              = $('div[data-type]');

	entries.each(function(index, element) {
        type             = $(this).attr('data-type');
        data_id          = $(this).attr('data-id');
        data_inputs      = {};
        entry_input_data = new Array();
        $(this).find('select[data-name], textarea[data-name], input[data-name]').each(function() {
        	data_string_name              = $(this).attr('data-name');
        	data_string_val               = $(this).val();
        	data_inputs[data_string_name] = data_string_val;
        	entry_input_data              = data_inputs;
        });
        if (type == 'option') {
        	data_inputs['answers']        = [];
			var ans_container                 = $(element).find('.answers').find('div.active');

			ans_container.find('input[data-answer]').each(function(index) {
        	    data_string_name          = $(this).attr('data-answer');
        	    data_string_val           = $(this).val();
        	    data_inputs['answers'].push(data_string_val);
            });
            if (ans_container.attr('data-ans-type') == 'text') {
            	data_inputs['answer']     = 't';
            }
            else{
            	data_inputs['answer']     = 'i';
            }
		}

		if (type == 'question') {
      data_inputs['answers']        = [];
			var ans_container             = $(element).find('.answers');
			
			ans_container.find('.answer-img-wrapper').each(function(index,elans) {
				var data_list_val         = {};
				$(elans).find('[data-answer]').each(function(index, el) {
          if ($(this).attr('type') == 'radio') {
            if ($(this).is(':checked')) {
              data_ans_key          = $(this).attr('data-answer');    
              data_list_val[data_ans_key]  = $(this).val();
            }
          }
          else{
            data_ans_key          = $(this).attr('data-answer');    
            data_list_val[data_ans_key]  = $(this).val();
          }
				});
				data_inputs['answers'].push(data_list_val);
            });
		}
    
    data = {
			type: type,
			data_inputs: entry_input_data,
			data_id: data_id,
			index_id: index + 1
		};
		data_entry.push(data);
    });
    var form_data = form.serialize();
    if (data_entry.length < 1) {
      swal({
        title: 'Error!',
        text: "{{LANG please_check_details}}!",
        type:"error",
        allowOutsideClick: false
      });
      return false;
    }

    $('.error-con').empty();
    $('.btn-save').attr('disabled', true);
    $('.btn-publish').attr('disabled', true);
    if (submit_type == 'publish') {
    	$('.btn-publish').html("<i class='fa fa-spinner fa-spin'></i> {{LANG please_wait}}");
    }

    else {
    	$('.btn-save').html("<i class='fa fa-spinner fa-spi'></i> {{LANG please_wait}}");
    }
    
    $.ajax({
    	type: 'POST',
    	url: FL_Ajax_Requests_File() + '?f=insert_post&post_type={{PAGE_TYPE}}',
    	dataType: 'json',
    	data: {submit_type:submit_type, data_entry:data_entry, form_data:form_data}, 
    	success: function (data) {
    		if (data.status == 400) {
    			data.error.forEach(function(entry) {
            $('#entry-' + entry.id).find('.error-con').html(entry.message);
          });
          FL_Scroll('entry-' + data.error[0].id);
    		}

        else if (data.status == 410) {
    			$('#title_con').find('.error-con').addClass('active').html(data.error);
    			FL_Scroll('title_con');
    		}

        else if (data.status == 460 || data.status == 470 || data.status == 480) {
    			$('#short_title_con').find('.error-con').addClass('active').html(data.error);
    			FL_Scroll('short_title_con');
    		}

        else if (data.status == 420) {
    			$('#tags_con').find('.error-con').html(data.error);
    			FL_Scroll('tags_con');
    		}

        else if (data.status == 430) {
    			$('#description_con').find('.error-con').html(data.error);
    			FL_Scroll('description_con');
    		}

        else if (data.status == 440) {
    			$('#category_con').find('.error-con').html(data.error);
    			FL_Scroll('category_con');
    		}

        else if (data.status == 450) {
          $('#image_con').find('.error-con').html(data.error);
          FL_Scroll('image_con');
        }

        else if (data.status == 451) {
          swal("{{LANG error}}", "{{LANG min_results_2}}", "error")
          FL_Scroll('title_con');

        }

        else if (data.status == 452) {
    			swal("{{LANG error}}", "{{LANG question_required}}", "error")
    			FL_Scroll('title_con');

    		}
        else if (data.status == 453) {
          swal("{{LANG error}}", "{{LANG min_results_more_than}}", "error")
          FL_Scroll('title_con');

        }
        else if (data.status == 454) {
          swal("{{LANG error}}", "{{LANG price_can_not_be_empty}}", "error")
          FL_Scroll('title_con');

        }

        else if (data.status == 200) {
    			location.href = data.href;
    		}
    	    data        = new Array();
	        arra_test   = new Array();
	        data_inputs = new Array();
	        data_entry  = new Array();
	        $('.btn-save').attr('disabled', false);
            $('.btn-publish').attr('disabled', false);
            $('.btn-save').html('<i class="fa fa-' + btn_save_icon + '"></i> ' + btn_save_text);
            $('.btn-publish').html('<i class="fa fa-' + btn_publish_icon + '"></i> ' + btn_publish_text);
        },
        error: function (request, status, error) {
          data        = new Array();
	        arra_test   = new Array();
	        data_inputs = new Array();
	        data_entry  = new Array();
	        $('.btn-save').attr('disabled', false);
            $('.btn-publish').attr('disabled', false);
            $('.btn-save').html('<i class="fa fa-' + btn_save_icon + '"></i> ' + btn_save_text);
            $('.btn-publish').html('<i class="fa fa-' + btn_publish_icon + '"></i> ' + btn_publish_text);
        }
    });

}

function FL_CreateQuizResult(self){

  FL_progressIconLoader($(self));
  $.ajax({
    url: FL_Ajax_Requests_File(),
    type: 'GET',
    dataType: 'json',
    data: {f: 'quiz',s:'add-result'},
  })
  .done(function(data) {
    if (data.status == 200) {
      if ($("[data-type='result']").length > 0) {
        $(data.html).insertAfter("[data-type='result']:last").scrollTo();
        FL_QuizSyncQR();
      }
      else{
        $("#create-quiz-results").prepend(data.html);
        FL_QuizSyncQR();
      }
      
    }
    FL_progressIconLoader($(self));
  })
  .fail(function() {
    console.log("error");
    FL_progressIconLoader($(self));
  })
}
function FL_CreateTriviaResult(self){

  FL_progressIconLoader($(self));
  $.ajax({
    url: FL_Ajax_Requests_File(),
    type: 'GET',
    dataType: 'json',
    data: {f: 'quiz',s:'add-result',type:'trivia'},
  })
  .done(function(data) {
    if (data.status == 200) {
      if ($("[data-type='result']").length > 0) {
        $(data.html).insertAfter("[data-type='result']:last").scrollTo();
        FL_QuizSyncQR();
      }
      else{
        $("#create-quiz-results").prepend(data.html);
        FL_QuizSyncQR();

      }
      
    }
    for (var i = 0; i <= $(".quiz_result").length - 1; i++) {
      $($(".quiz_result")[i]).html(i+' of '+($(".quiz_result").length - 1))
    }
    FL_progressIconLoader($(self));
  })
  .fail(function() {
    console.log("error");
    FL_progressIconLoader($(self));
  })
}
function FL_CreateTriviaQuestion(self){

  FL_progressIconLoader($(self));
  $.ajax({
    url: FL_Ajax_Requests_File(),
    type: 'GET',
    dataType: 'json',
    data: {f: 'quiz',s:'add-question',type:'trivia'},
  })
  .done(function(data) {
    if (data.status == 200) {
      if ($("[data-type='question']").length > 0) {
        $(data.html).insertAfter("[data-type='question']:last").scrollTo();
        FL_QuizSyncQR();
      }
      else{
        $("#create-quiz-questions").prepend(data.html);
        FL_QuizSyncQR();
      }
      
    }
    FL_progressIconLoader($(self));
  })
  .fail(function() {
    console.log("error");
    FL_progressIconLoader($(self));
  })
}
function FL_AddTriviaAnswer(id) {
  if (!id) { return false;}
  var question_container = $('#entry-' + id);
  var question_answer_id = question_container.find('.pick-questionans-img:last').attr('data-id'); 
  question_answer_id     = (question_answer_id) ? question_answer_id : 0;
  $.ajax({
    url: FL_Ajax_Requests_File(),
    type: 'GET',
    dataType: 'json',
    data: {f: 'quiz',s:'answer',type:'trivia',id:id,index:question_answer_id},
  })
  .done(function(data) {
    if (data.status == 200) {
      var answer =  $(data.html);
      question_container.find('.answers').find('#question-answers').append(answer);
      FL_QuizSyncQR();
    }
  })
  .fail(function() {
    console.log("error");
  })
}
function FL_RemoveResultEntryTrivia(id) {
  if (parseInt($(".quiz_result").length) < 3) {
    return true;
  }
  else{
    var result_index = ($('#entry-' + id).index() + 1);
    var box          = $('#entry-' + id).slideUp(200, function () {
      $(this).remove();
      FL_QuizSyncQR();
      for (var i = 0; i <= $(".quiz_result").length - 1; i++) {
        $($(".quiz_result")[i]).html(i+' of '+($(".quiz_result").length - 1))
      }
    });
  }
}
function FL_QuizSyncQR(){
  var results   = $('[data-type="result"]');
  var questions = $('[data-type="question"]');
  if (results.length < 1 || questions.length < 1) {
    return false;
  }

  $('[data-type="question"]').each(function(index_q, el_q) {
      $(el_q).find('select').empty();
      $("[data-type='result']").each(function(index_r, el_r) {
        var result_index = (index_r += 1);
        $(el_q).find('select').append('<option value="'+result_index+'">{{LANG result}} '+result_index+'</option>');
      });
      
  });
}

function FL_CreateQuizQuestion(self){

  FL_progressIconLoader($(self));
  $.ajax({
    url: FL_Ajax_Requests_File(),
    type: 'GET',
    dataType: 'json',
    data: {f: 'quiz',s:'add-question'},
  })
  .done(function(data) {
    if (data.status == 200) {
      if ($("[data-type='question']").length > 0) {
        $(data.html).insertAfter("[data-type='question']:last").scrollTo();
        FL_QuizSyncQR();
      }
      else{
        $("#create-quiz-questions").prepend(data.html);
        FL_QuizSyncQR();
      }
      
    }
    FL_progressIconLoader($(self));
  })
  .fail(function() {
    console.log("error");
    FL_progressIconLoader($(self));
  })
}

function FL_CreateFlipQuestion(self){

  FL_progressIconLoader($(self));
  $.ajax({
    url: FL_Ajax_Requests_File(),
    type: 'GET',
    dataType: 'json',
    data: {f: 'quiz',s:'add-question',type:'flip'},
  })
  .done(function(data) {
    if (data.status == 200) {
      if ($("[data-type='question']").length > 0) {
        $(data.html).insertAfter("[data-type='question']:last").scrollTo();
        FL_QuizSyncQR();
      }
      else{
        $("#create-quiz-questions").prepend(data.html);
        FL_QuizSyncQR();
      }
      
    }
    FL_progressIconLoader($(self));
  })
  .fail(function() {
    console.log("error");
    FL_progressIconLoader($(self));
  })
}

function FL_AddQuizAnswer(id) {
  if (!id) { return false;}
  var question_container = $('#entry-' + id);
  var question_answer_id = question_container.find('.pick-questionans-img:last').attr('data-id'); 
  question_answer_id     = (question_answer_id) ? question_answer_id : 0;
  $.ajax({
    url: FL_Ajax_Requests_File(),
    type: 'GET',
    dataType: 'json',
    data: {f: 'quiz',s:'answer',id:id,index:question_answer_id},
  })
  .done(function(data) {
    if (data.status == 200) {
      var answer =  $(data.html);
      question_container.find('.answers').find('#question-answers').append(answer);
      FL_QuizSyncQR();
    }
  })
  .fail(function() {
    console.log("error");
  })
}


function FL_RemoveResultEntry(id) {
  var result_index = ($('#entry-' + id).index() + 1);
  var box          = $('#entry-' + id).slideUp(200, function () {
    $(this).remove();
    FL_QuizSyncQR();
  });
}

function FL_UploadVideo(id,self){
  if (!self || !id) { return false;}
  var data = new FormData();
  data.append('video',$(self).prop('files')[0]);
  $("#img-uploading-wrapper").removeClass('hidden');
  $.ajax({
    url: FL_Ajax_Requests_File() + "?f=upload&s=video",
    type: 'POST',
    data: data,
    processData: false,
    contentType: false,
    data: data,
  })
  .done(function(data) {
    if (data.status == 200) {
      $("#entry-"+id).find('#fetched-video').html(data.html);
      $("#entry-"+id).find('.btn-main').attr('disabled', 'true');
      $("#entry-"+id).find('#entry_video_type').val('source');
      $("#entry-"+id).find('#entry_video_id').val(0);
      $("#entry-"+id).find('#entry_video_src').val(data.filename);
    }

    else if(data.status == 401){
      swal(
        '{{LANG error}}',
        data.message,
        'error'
      )
    }

    else{
      swal(
        '{{LANG error}}',
        '{{LANG error_not_supported_video}}',
        'error'
      )
    }
    $("#img-uploading-wrapper").addClass('hidden');
  })
  .fail(function() {
    console.log("error");
  })

}

jQuery(document).ready(function($) {
	$(document).on('click', '.pick-answer-img', function(event) {
		event.preventDefault();
		var entry_time = $(this).attr('id');
		var index      = $(this).attr('data-id');
		$("#opt-img-"+entry_time).attr('data-index', index).trigger('click');
	});

	$(document).on('click', '.pick-questionans-img', function(event) {
		event.preventDefault();
		var entry_time = $(this).attr('id');
		var index      = $(this).attr('data-id');
		$("#questionans-img-"+entry_time).attr('data-index', index).trigger('click');
	});

});
</script>